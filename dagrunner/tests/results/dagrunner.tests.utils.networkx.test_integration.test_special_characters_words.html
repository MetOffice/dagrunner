
<!DOCTYPE html>
<html>
<body>

<style>
div.mermaidTooltip {
    position: absolute;
    text-align: left;
    max-width: 700px;
    padding: 2px;
    font-family: "trebuchet ms", verdana, arial, sans-serif;
    font-size: 12px;
    background: hsl(80, 100%, 96.2745098039%);
    border: 1px solid #aaaa33;
    border-radius: 2px;
    pointer-events: none;
    z-index: 100;
}

tr:nth-child(even) { background: #CCC }
tr:nth-child(odd) { background: #FFF }

html, body {
    margin: 0;
    padding: 0;
    height: 100%;
    overflow: hidden; /* Prevent page scrollbars */
    display: flex;
    flex-direction: column;
}

/* 
td {
  white-space: nowrap;
}
*/

#controls {
    height: 25px;
    margin-bottom: 3px;
    margin-top: 3px;
    flex-shrink: 0; /* Prevent shrinking */
}

#mermaid-container {
    height: 70vh;
    min-height: 50px; /* Allow resizing very small */
    max-height: 90vh; /* Allow resizing very small */
    overflow: hidden; /* Add vertical scrollbar if needed */
    resize: vertical; /* Allow resizing */
    flex-shrink: 0; /* Prevent flex behaviour from overriding resize */
    border: 1px solid #ccc;
}

#table1 {
    min-height: 0; /* Allow shrinking to 0 height */
    flex-grow: 1; /* Take up remaining space */
    overflow: auto; /* Add vertical scrollbar if needed */
}

#diagram-wrapper {
    cursor: grab;
}

#diagram-wrapper:active {
    cursor: grabbing;
}

.mermaid {
    transform-origin: 0 0; /* Set the origin for scaling */
}

</style>

<div id="controls">
  <button id="toggle-zoom">Zoom Behaviour: Cursor-Relative</button>
  <button id="reset-zoom">Reset to Origin</button>
  <button id="save-diagram">Save as SVG</button>
</div>
<div id="mermaid-container">
<div id="diagram-wrapper">
<div class="mermaid">
---
title: 
---
graph TD

0(["0<br>D:a_L:1"])
click 0 callback "{'node data': {'call': ('#lt;function test_basic.#lt;locals#gt;.#lt;lambda#gt; at '<br>'0x7f04ce115048#gt;',<br>{'init_arg': 'ia_a'},<br>{'call_arg': 'ca_a'}),<br>'diagnostic': 'a',<br>'leadtime': 1,<br>'prop': 'prop_a',<br>'testparam': 'interpolate'}}"
1(["1<br>D:b_L:1"])
click 1 callback "{'node data': {'call': ('module.path.b',<br>{'init_arg': 'ia_b'},<br>{'call_arg': 'ca_b'}),<br>'diagnostic': 'b',<br>'leadtime': 1,<br>'prop': 'prop_b'}}"
0 --> 1
2(["2<br>D:c_L:1"])
click 2 callback "{'node data': {'call': ('module.path.c',<br>{'init_arg': 'ia_c'},<br>{'call_arg': 'ca_c'}),<br>'diagnostic': 'c',<br>'leadtime': 1,<br>'prop': 'prop_c'}}"
3(["3<br>D:d_L:1"])
click 3 callback "{'node data': {'call': ('module.path.d',<br>{'init_arg': 'ia_d'},<br>{'call_arg': 'ca_d'}),<br>'diagnostic': 'd',<br>'leadtime': 1,<br>'prop': 'prop_d'}}"
2 --> 3
4(["4<br>D:e_L:1"])
click 4 callback "{'node data': {'call': ('module.path.e',<br>{'init_arg': 'ia_e'},<br>{'call_arg': 'ca_e'}),<br>'diagnostic': 'e',<br>'leadtime': 1,<br>'prop': 'prop_e'}}"
1 --> 4
3 --> 4
5(["5<br>D:a_L:2"])
click 5 callback "{'node data': {'call': ('#lt;function test_basic.#lt;locals#gt;.#lt;lambda#gt; at '<br>'0x7f04ce115048#gt;',<br>{'init_arg': 'ia_a'},<br>{'call_arg': 'ca_a'}),<br>'diagnostic': 'a',<br>'leadtime': 2,<br>'prop': 'prop_a',<br>'testparam': 'interpolate'}}"
6(["6<br>D:b_L:2"])
click 6 callback "{'node data': {'call': ('module.path.b',<br>{'init_arg': 'ia_b'},<br>{'call_arg': 'ca_b'}),<br>'diagnostic': 'b',<br>'leadtime': 2,<br>'prop': 'prop_b'}}"
5 --> 6
7(["7<br>D:c_L:2"])
click 7 callback "{'node data': {'call': ('module.path.c',<br>{'init_arg': 'ia_c'},<br>{'call_arg': 'ca_c'}),<br>'diagnostic': 'c',<br>'leadtime': 2,<br>'prop': 'prop_c'}}"
8(["8<br>D:d_L:2"])
click 8 callback "{'node data': {'call': ('module.path.d',<br>{'init_arg': 'ia_d'},<br>{'call_arg': 'ca_d'}),<br>'diagnostic': 'd',<br>'leadtime': 2,<br>'prop': 'prop_d'}}"
7 --> 8
9(["9<br>D:e_L:2"])
click 9 callback "{'node data': {'call': ('module.path.e',<br>{'init_arg': 'ia_e'},<br>{'call_arg': 'ca_e'}),<br>'diagnostic': 'e',<br>'leadtime': 2,<br>'prop': 'prop_e'}}"
6 --> 9
8 --> 9
</div>
</div>
</div>

<script type="module">
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@9/dist/mermaid.esm.min.mjs';
  mermaid.initialize({
        startOnLoad: true,
        flowchart: { useMaxWidth: false, htmlLabels: true, curve: 'basis' },
        securityLevel:'loose',
        maxTextSize: 99999999  // beyond this "Maximum text size in diagram exceeded"
  });

  const wrapper = document.getElementById('diagram-wrapper');
  const mermaidDiagram = document.querySelector('.mermaid');
  const toggleButton = document.getElementById('toggle-zoom');
  const resetButton = document.getElementById('reset-zoom');
  const saveButton = document.getElementById('save-diagram');
  let scale = 1;
  let offsetX = 0;
  let offsetY = 0;
  let zoomRelativeToCursor = true; // Default behaviour: cursor-relative zoom

  const updateTransform = () => {
    mermaidDiagram.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
  };

  toggleButton.addEventListener('click', () => {
    zoomRelativeToCursor = !zoomRelativeToCursor;
    toggleButton.textContent = `Zoom Behaviour: ${zoomRelativeToCursor ? 'Cursor-Relative' : 'Origin-Based'}`;
  });

  resetButton.addEventListener('click', () => {
      // Reset to default scale and position
      scale = 1;
      offsetX = 0;
      offsetY = 0;
      updateTransform();
  });

  saveButton.addEventListener('click', () => {
    // Extract the rendered SVG from the DOM
    const svgElement = document.querySelector('#mermaid-container svg');
   if (!svgElement) {
      alert('No diagram found to save!');
      return;
    }

   // Serialize the SVG to a string
    const serializer = new XMLSerializer();
    const svgContent = serializer.serializeToString(svgElement);

   // Create a Blob from the SVG string
    const blob = new Blob([svgContent], { type: 'image/svg+xml;charset=utf-8' });

   // Create a link element to trigger the download
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'mermaid-diagram.svg';
    link.click();

   // Clean up the temporary object URL
    URL.revokeObjectURL(link.href);
  });

  // Zoom functionality
  wrapper.addEventListener('wheel', (event) => {
    event.preventDefault();
    const zoomStep = 0.1;
    const minScale = 0.2;
    const maxScale = 2;
    const newScale = Math.min(Math.max(scale + (event.deltaY > 0 ? -zoomStep : zoomStep), minScale), maxScale);
    if (zoomRelativeToCursor) {
      // Cursor-relative zoom
      const rect = wrapper.getBoundingClientRect();
      const cursorX = event.clientX - rect.left; // Cursor position relative to wrapper
      const cursorY = event.clientY - rect.top;
      offsetX -= (cursorX - offsetX) * (newScale / scale - 1);
      offsetY -= (cursorY - offsetY) * (newScale / scale - 1);
    }
    scale = newScale;
    updateTransform();
  });

  // Pan functionality
  let isDragging = false;
  let startX, startY;
  wrapper.addEventListener('mousedown', (event) => {
    isDragging = true;
    startX = event.clientX;
    startY = event.clientY;
  });

  wrapper.addEventListener('mousemove', (event) => {
    if (isDragging) {
      const deltaX = event.clientX - startX;
      const deltaY = event.clientY - startY;
      offsetX += deltaX;
      offsetY += deltaY;
      startX = event.clientX;
      startY = event.clientY;
      updateTransform();
    }
  });

  wrapper.addEventListener('mouseup', () => {
    isDragging = false;
  });

  wrapper.addEventListener('mouseleave', () => {
    isDragging = false;
  });

</script>

<div id="table1" class="scrollable">
<table>
<tr>
<th>id</th>
<th>node</th>
<th>info</th>
</tr>

<tr><td>0</td><td>D:a_L:1</td><td>{'node data': {'call': ('&lt;function test_basic.&lt;locals&gt;.&lt;lambda&gt; at '
'0x7f04ce115048&gt;',
{'init_arg': 'ia_a'},
{'call_arg': 'ca_a'}),
'diagnostic': 'a',
'leadtime': 1,
'prop': 'prop_a',
'testparam': 'interpolate'}}</td></tr>
<tr><td>1</td><td>D:b_L:1</td><td>{'node data': {'call': ('module.path.b',
{'init_arg': 'ia_b'},
{'call_arg': 'ca_b'}),
'diagnostic': 'b',
'leadtime': 1,
'prop': 'prop_b'}}</td></tr>
<tr><td>2</td><td>D:c_L:1</td><td>{'node data': {'call': ('module.path.c',
{'init_arg': 'ia_c'},
{'call_arg': 'ca_c'}),
'diagnostic': 'c',
'leadtime': 1,
'prop': 'prop_c'}}</td></tr>
<tr><td>3</td><td>D:d_L:1</td><td>{'node data': {'call': ('module.path.d',
{'init_arg': 'ia_d'},
{'call_arg': 'ca_d'}),
'diagnostic': 'd',
'leadtime': 1,
'prop': 'prop_d'}}</td></tr>
<tr><td>4</td><td>D:e_L:1</td><td>{'node data': {'call': ('module.path.e',
{'init_arg': 'ia_e'},
{'call_arg': 'ca_e'}),
'diagnostic': 'e',
'leadtime': 1,
'prop': 'prop_e'}}</td></tr>
<tr><td>5</td><td>D:a_L:2</td><td>{'node data': {'call': ('&lt;function test_basic.&lt;locals&gt;.&lt;lambda&gt; at '
'0x7f04ce115048&gt;',
{'init_arg': 'ia_a'},
{'call_arg': 'ca_a'}),
'diagnostic': 'a',
'leadtime': 2,
'prop': 'prop_a',
'testparam': 'interpolate'}}</td></tr>
<tr><td>6</td><td>D:b_L:2</td><td>{'node data': {'call': ('module.path.b',
{'init_arg': 'ia_b'},
{'call_arg': 'ca_b'}),
'diagnostic': 'b',
'leadtime': 2,
'prop': 'prop_b'}}</td></tr>
<tr><td>7</td><td>D:c_L:2</td><td>{'node data': {'call': ('module.path.c',
{'init_arg': 'ia_c'},
{'call_arg': 'ca_c'}),
'diagnostic': 'c',
'leadtime': 2,
'prop': 'prop_c'}}</td></tr>
<tr><td>8</td><td>D:d_L:2</td><td>{'node data': {'call': ('module.path.d',
{'init_arg': 'ia_d'},
{'call_arg': 'ca_d'}),
'diagnostic': 'd',
'leadtime': 2,
'prop': 'prop_d'}}</td></tr>
<tr><td>9</td><td>D:e_L:2</td><td>{'node data': {'call': ('module.path.e',
{'init_arg': 'ia_e'},
{'call_arg': 'ca_e'}),
'diagnostic': 'e',
'leadtime': 2,
'prop': 'prop_e'}}</td></tr>
</table>

</div>

</body>
</html>
